<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>DSA Lab System â€“ Wedad</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --green-main: #4caf6a;
      --green-light: #e7f7ee;
      --green-dark: #2f7b48;
      --bg: #f5f7fa;
      --card-radius: 16px;
      --shadow-soft: 0 10px 25px rgba(0,0,0,0.08);
      --transition: 0.25s ease;
      --danger: #ff5252;
      --gray: #888;
      --font-ar: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    * {
      box-sizing: border-box;
      font-family: var(--font-ar);
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top left, #f0fff7 0, #f5f7fa 40%, #eaf5ff 100%);
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      color: #222;
    }

    .app-shell {
      width: 100%;
      max-width: 1200px;
      margin: 16px;
      background: rgba(255,255,255,0.96);
      border-radius: 24px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 16px 24px;
      border-bottom: 1px solid #edf2f7;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      background: linear-gradient(90deg, var(--green-main), #7bd389);
      color: #fff;
    }

    header .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    header h1 {
      margin: 0;
      font-size: 1.4rem;
      letter-spacing: 0.03em;
    }

    header small {
      opacity: 0.9;
      font-size: 0.8rem;
    }

    header .user-info {
      text-align: left;
      font-size: 0.8rem;
    }

    header .user-info strong {
      display: block;
      font-size: 0.9rem;
    }

    main {
      padding: 20px;
      overflow: auto;
      flex: 1;
    }

    /* ---------- login ---------- */
    .screen {
      display: none;
      animation: fadeIn 0.25s ease;
    }
    .screen.active {
      display: block;
    }

    .centered {
      max-width: 420px;
      margin: 40px auto;
      background: #fff;
      padding: 28px 24px 26px;
      border-radius: 20px;
      box-shadow: var(--shadow-soft);
      text-align: center;
    }

    .logo-circle {
      width: 62px;
      height: 62px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--green-main), var(--green-dark));
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      font-size: 1.4rem;
      margin: 0 auto 10px;
    }

    h2 {
      margin: 6px 0 10px;
      font-size: 1.3rem;
    }

    .subtitle {
      font-size: 0.9rem;
      color: var(--gray);
      margin-bottom: 14px;
    }

    .subtitle small {
      display: block;
      font-size: 0.82rem;
    }

    .field {
      text-align: right;
      margin-bottom: 10px;
    }

    .field label {
      display: block;
      margin-bottom: 4px;
      font-size: 0.85rem;
      color: #444;
    }

    .field input, .field select, .field textarea {
      width: 100%;
      padding: 9px 10px;
      border-radius: 10px;
      border: 1px solid #d1d9e6;
      outline: none;
      font-size: 0.9rem;
      transition: var(--transition);
      background: #fbfcff;
    }

    .field input:focus, .field select:focus, .field textarea:focus {
      border-color: var(--green-main);
      box-shadow: 0 0 0 2px rgba(76,175,106,0.18);
      background: #fff;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 9px 16px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: var(--transition);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--green-main), var(--green-dark));
      color: #fff;
      width: 100%;
      margin-top: 4px;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(76,175,80,0.3);
    }

    .btn-ghost {
      background: transparent;
      color: var(--green-dark);
    }

    .helper-text {
      font-size: 0.8rem;
      color: var(--gray);
      margin-top: 6px;
    }

    .helper-text code {
      background: #f0f4f8;
      padding: 1px 6px;
      border-radius: 999px;
      font-size: 0.76rem;
    }

    .error-msg {
      color: var(--danger);
      font-size: 0.8rem;
      margin-top: 4px;
      min-height: 16px;
    }

    /* --------- welcome banner --------- */
    .welcome-banner {
      margin-bottom: 16px;
      padding: 14px 14px 14px 18px;
      border-radius: 18px;
      background: linear-gradient(120deg, var(--green-main), #7fe0a3);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .welcome-banner .text-block {
      max-width: 80%;
    }

    .welcome-banner h3 {
      margin: 0 0 6px;
      font-size: 1.1rem;
    }

    .welcome-banner p {
      margin: 0;
      font-size: 0.9rem;
    }

    .welcome-banner p small {
      display: block;
      font-size: 0.78rem;
      opacity: 0.9;
    }

    .welcome-icon {
      font-size: 1.5rem;
    }

    /* ---------- cards dashboard ---------- */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 14px;
    }

    .card {
      background: var(--green-light);
      border-radius: var(--card-radius);
      padding: 14px 12px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.06);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: var(--transition);
      border: 1px solid #cfe8da;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.08);
      background: #def7ea;
    }

    .card-icon {
      font-size: 1.3rem;
      margin-bottom: 2px;
    }

    .card-title-ar {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .card-title-en {
      font-size: 0.78rem;
      color: #4d6b5b;
    }

    .card-caption {
      font-size: 0.78rem;
      color: var(--gray);
      margin-top: 2px;
    }

    /* --------- sections ---------- */
    .section-panel {
      margin-top: 18px;
      padding: 16px;
      background: #fff;
      border-radius: 18px;
      box-shadow: var(--shadow-soft);
      border: 1px solid #e1e7f0;
    }
    .section-panel h3 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 1.05rem;
    }
    .section-subtitle {
      font-size: 0.82rem;
      color: var(--gray);
      margin-bottom: 12px;
    }

    .section-actions {
      margin-top: 12px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .two-column {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
      gap: 10px 16px;
    }

    .section-footer-note {
      font-size: 0.8rem;
      color: var(--gray);
      margin-top: 10px;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    /* search results */
    .results-box {
      margin-top: 12px;
      padding: 10px;
      border-radius: 12px;
      background: #f7fafc;
      border: 1px dashed #cbd5e0;
      font-size: 0.85rem;
      max-height: 260px;
      overflow: auto;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #e2f7ec;
      color: #25623a;
      margin-inline-end: 4px;
    }

    .badge.gray {
      background: #edf2f7;
      color: #4a5568;
    }

    .label-en {
      font-size: 0.75rem;
      color: #718096;
    }

    /* settings badge button */
    .settings-button {
      position: fixed;
      left: 18px;
      bottom: 18px;
      z-index: 50;
    }

    .settings-chip {
      background: #ffffff;
      border-radius: 999px;
      padding: 6px 12px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.18);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      font-size: 0.8rem;
      color: #2d3748;
      border: 1px solid #e2e8f0;
    }

    .settings-chip span.icon {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: var(--green-main);
      color: #fff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
    }

    /* specialist-only tag */
    .specialist-tag {
      font-size: 0.76rem;
      color: #c53030;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .pill {
      padding: 1px 8px;
      border-radius: 999px;
      background: #fed7d7;
      color: #822727;
      font-size: 0.7rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(160px,1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .stat-card {
      padding: 10px 10px 9px;
      border-radius: 14px;
      background: #f0fff4;
      border: 1px solid #c6f6d5;
      font-size: 0.86rem;
    }

    .stat-card strong {
      font-size: 1.1rem;
    }

    .muted {
      color: var(--gray);
      font-size: 0.8rem;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 640px) {
      header {
        flex-direction: column;
        align-items: flex-start;
      }
      .welcome-banner {
        flex-direction: column;
        align-items: flex-start;
      }
      .welcome-banner .text-block {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>

<div class="app-shell">
  <header>
    <div class="title-block">
      <h1>DSA Lab System ğŸ’š</h1>
      <small>Ø¥Ø¯Ø§Ø±Ø© ØªØ¯ÙÙ‘Ù‚ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© ÙˆØ§Ù„Ù…Ø¹Ù…Ù„ â€“ Developed by Wedad Aljabari</small>
    </div>
    <div class="user-info" id="userInfo">
      <strong id="userNameHeader">ØºÙŠØ± Ù…Ø³Ø¬Ù‘Ù„</strong>
      <span id="userRoleHeader">â€”</span>
    </div>
  </header>

  <main>
    <!-- ğŸ” Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <section class="screen active" id="loginScreen">
      <div class="centered">
        <div class="logo-circle">DS</div>
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <div class="subtitle">
          ÙŠØ§ Ù‡Ù„Ø§ Ø¨ÙƒÙ„ Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ù…Ø¹Ù…Ù„ ğŸ‘‹ğŸ’š
          <small>Welcome to DSA Lab System â€“ please log in to continue.</small>
        </div>

        <div class="field">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… <span class="label-en">Username</span></label>
          <input id="loginName" type="text" placeholder="Ù…Ø«Ø§Ù„: Wedad" />
        </div>
        <div class="field">
          <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± <span class="label-en">Password</span></label>
          <input id="loginPassword" type="password" placeholder="â€¢â€¢â€¢â€¢" />
        </div>

        <button class="btn btn-primary" id="loginBtn">
          Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…
        </button>

        <div class="helper-text">
          ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„ÙØ±ÙŠÙ‚: <code>1234</code>  
          ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠØ©: <code>0987</code>
        </div>
        <div class="error-msg" id="loginError"></div>
      </div>
    </section>

    <!-- ğŸŒŸ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ + Ù„ÙˆØ­Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª -->
    <section class="screen" id="dashboardScreen">

      <div class="welcome-banner">
        <div class="text-block">
          <h3>ÙŠØ§ Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙŠØ§ Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ù…Ø¹Ù…Ù„ ğŸ’š</h3>
          <p>
            Ø¬Ø§Ù‡Ø²ÙŠÙ† Ù†Ø´ÙˆÙ Ø§Ù„Ø­Ø§Ù„Ø§Øª ÙˆÙ†Ø±ØªÙ‘Ø¨ Ø§Ù„ÙŠÙˆÙ…ØŸ  
            <small>Ready to track your lab cases and make today full of achievementsØŸ</small>
          </p>
        </div>
        <div class="welcome-icon">ğŸ“Š</div>
      </div>

      <div class="cards-grid">
        <div class="card" data-section="newCaseSection">
          <div class="card-icon">ğŸ“</div>
          <div class="card-title-ar">ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
          <div class="card-title-en">New Case</div>
          <div class="card-caption">Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø©</div>
        </div>

        <div class="card" data-section="labReceiveSection">
          <div class="card-icon">ğŸ­</div>
          <div class="card-title-ar">Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù…Ù„</div>
          <div class="card-title-en">Receive from Lab</div>
          <div class="card-caption">ØªØ£ÙƒÙŠØ¯ ÙˆØµÙˆÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù„Ù…Ø¹Ù…Ù„ Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</div>
        </div>

        <div class="card" data-section="searchSection">
          <div class="card-icon">ğŸ”</div>
          <div class="card-title-ar">Ø¨Ø­Ø« Ø¹Ù† Ø­Ø§Ù„Ø©</div>
          <div class="card-title-en">Search Case</div>
          <div class="card-caption">Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</div>
        </div>

        <div class="card" data-section="assistantReceiveSection">
          <div class="card-icon">ğŸ“¦</div>
          <div class="card-title-ar">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</div>
          <div class="card-title-en">Assistant Receive</div>
          <div class="card-caption">ØªÙˆÙ‚ÙŠØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØªØ­ÙÙŠØ² Ø¨Ø³ÙŠØ·</div>
        </div>

        <div class="card" data-section="statsSection">
          <div class="card-icon">ğŸ“Š</div>
          <div class="card-title-ar">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
          <div class="card-title-en">Statistics</div>
          <div class="card-caption">Ù„Ù„Ø£Ø®ØµØ§Ø¦ÙŠØ© ÙÙ‚Ø· â€“ Ø±Ø¤ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ø¥Ù†ØªØ§Ø¬</div>
        </div>

        <div class="card" data-section="rejectedSection">
          <div class="card-icon">ğŸ—‚</div>
          <div class="card-title-ar">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©</div>
          <div class="card-title-en">Rejected Cases</div>
          <div class="card-caption">ØªÙ… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù‚Ø¨Ù„ Ø£Ø®Ø° Ø§Ù„Ø·Ø¨Ø¹Ø©</div>
        </div>
      </div>

      <!-- ğŸ“ Ù‚Ø³Ù… ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© -->
      <section class="section-panel" id="newCaseSection" style="display:none;">
        <h3>ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© â€“ From Clinic</h3>
        <div class="section-subtitle">
          Ù†Ø¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©: Ù†Ø¶ÙŠÙ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶ØŒ ÙŠÙ†Ø¹Ù…Ù„ Ø±Ù‚Ù… Ù…Ø¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØŒ ÙˆÙŠÙ†Ø­ÙØ¸ Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø¹ Ø£ÙˆÙ„ Ø®Ø·ÙˆØ©.
        </div>

        <form id="newCaseForm">
          <div class="two-column">
            <div class="field">
              <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù <span class="label-en">File Number</span></label>
              <input type="text" id="fileNumberInput" required />
            </div>
            <div class="field">
              <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶ <span class="label-en">Patient Name</span></label>
              <input type="text" id="patientNameInput" required />
            </div>
            <div class="field">
              <label>Ø±Ù‚Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© <span class="label-en">Clinic Number</span></label>
              <input type="text" id="clinicNumberInput" required />
            </div>
            <div class="field">
              <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨ <span class="label-en">Doctor Name</span></label>
              <input type="text" id="doctorNameInput" />
            </div>
            <div class="field">
              <label>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„Ø© <span class="label-en">Case Type</span></label>
              <select id="caseTypeInput">
                <option value="crown">Crown / PFM</option>
                <option value="rpd">RPD</option>
                <option value="tm">Temporary</option>
                <option value="ortho">Ortho</option>
                <option value="implant">Implant</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="field">
              <label>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø±ÙŠØ¶ Ø§Ù„Ù‚Ø§Ø¯Ù… <span class="label-en">Next Appointment</span></label>
              <input type="date" id="nextAppointmentInput" />
            </div>
          </div>

          <div class="field">
            <label>Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø¯ÙƒØªÙˆØ± (Ø¥Ù† ÙˆÙØ¬Ø¯Øª) <span class="label-en">Doctor Note</span></label>
            <textarea id="noteInput" placeholder="Ù…Ø«Ø§Ù„: Upper RPD â€“ reline, shade A2"></textarea>
          </div>

          <div class="field">
            <label>Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨ / R4 Snap (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input type="url" id="imageUrlInput" placeholder="Ù…Ø«Ø§Ù„: Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø£Ùˆ Ù„Ù‚Ø·Ø© Ù…Ù† R4" />
          </div>

          <div class="section-actions">
            <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
            <button type="button" class="btn btn-ghost" id="clearNewCaseBtn">ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
          </div>
          <div class="section-footer-note">
            Ø¹Ù†Ø¯ Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø©:
            <span class="badge">Lab Number</span> ÙŠØªÙˆÙ„Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ
            ÙˆÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø­Ø±ÙƒØ© ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„ØªØªØ¨Ø¹ <strong>tracking</strong> Ø¨Ø­Ø§Ù„Ø©:
            <em>Entered from Clinic</em>.
          </div>
          <div class="error-msg" id="newCaseError"></div>
        </form>
      </section>

      <!-- ğŸ­ Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù…Ù„ â€“ Ø¨Ø³ÙŠØ· ÙƒØ¨Ø¯Ø§ÙŠØ© -->
      <section class="section-panel" id="labReceiveSection" style="display:none;">
        <h3>ğŸ­ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ù…Ø¹Ù…Ù„</h3>
        <div class="section-subtitle">
          Ù‡Ù†Ø§ Ø§Ù„Ø¹Ø§Ù…Ù„/Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙŠÙ…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ùˆ ÙŠÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù Ù„ØªØ£ÙƒÙŠØ¯ ÙˆØµÙˆÙ„ Ø§Ù„Ø­Ø§Ù„Ø© ÙØ¹Ù„ÙŠØ§Ù‹ Ù„Ù„Ù…Ø¹Ù…Ù„.
        </div>

        <form id="labReceiveForm">
          <div class="two-column">
            <div class="field">
              <label>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ / ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¹Ù…Ù„ <span class="label-en">Barcode / Lab Code</span></label>
              <input type="text" id="barcodeReceiveInput" />
            </div>
            <div class="field">
              <label>Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù <span class="label-en">File Number</span></label>
              <input type="text" id="fileReceiveInput" />
            </div>
          </div>
          <div class="section-actions">
            <button class="btn btn-primary" type="submit">ØªØ£ÙƒÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø¹Ù…Ù„</button>
          </div>
          <div class="section-footer-note">
            Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¶ÙŠÙ Ø­Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ <strong>tracking</strong> Ø¨Ø­Ø§Ù„Ø©
            <span class="badge">Received at Lab</span>  
            ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… ÙŠÙƒÙˆÙ† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù„ÙŠ Ø¯Ø®Ù„ Ù„Ù„Ù†Ø¸Ø§Ù….
          </div>
          <div class="error-msg" id="labReceiveError"></div>
        </form>
      </section>

      <!-- ğŸ“¦ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© / ØªÙˆÙ‚ÙŠØ¹ Ù„Ø·ÙŠÙ -->
      <section class="section-panel" id="assistantReceiveSection" style="display:none;">
        <h3>ğŸ“¦ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù…Ù† Ø§Ù„ÙÙ†ÙŠ / ØªØ³Ù„ÙŠÙ… Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©</h3>
        <div class="section-subtitle">
          Ù‡Ù†Ø§ ÙŠØªÙ… ØªØ£ÙƒÙŠØ¯ Ø£Ù† Ø§Ù„Ø­Ø§Ù„Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©ØŒ Ù…Ø¹ ØªÙˆÙ‚ÙŠØ¹ Ø¨Ø³ÙŠØ· ÙˆØ¹Ø¨Ø§Ø±Ø© ØªØ­ÙÙŠØ²ÙŠØ© Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© âœ¨
        </div>

        <form id="assistantReceiveForm">
          <div class="two-column">
            <div class="field">
              <label>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ / ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¹Ù…Ù„</label>
              <input type="text" id="assistantBarcodeInput" />
            </div>
            <div class="field">
              <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© / Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…Ø³ØªÙ„Ù…</label>
              <input type="text" id="assistantNameInput" placeholder="Ù…Ø«Ø§Ù„: Wedad" />
            </div>
          </div>

          <div class="section-actions">
            <button type="submit" class="btn btn-primary">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©</button>
          </div>
          <div class="section-footer-note">
            Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸ ØªØ¸Ù‡Ø± Ø¹Ø¨Ø§Ø±Ø©:
            <strong>â€œÙŠØ¹Ø·ÙŠÙƒ Ø§Ù„Ø¹Ø§ÙÙŠØ©ØŒ Ø®Ø·ÙˆØ© Ø¬Ø¯ÙŠØ¯Ø© ØªÙ‚Ø±Ù‘Ø¨Ù†Ø§ Ù…Ù† Ø§Ø¨ØªØ³Ø§Ù…Ø© Ø§Ù„Ù…Ø±ÙŠØ¶ Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© ğŸ’šâ€</strong>
          </div>
          <div class="error-msg" id="assistantReceiveError"></div>
        </form>
      </section>

      <!-- ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø­Ø§Ù„Ø© -->
      <section class="section-panel" id="searchSection" style="display:none;">
        <h3>ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø­Ø§Ù„Ø©</h3>
        <div class="section-subtitle">
          Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ Ø¨Ø±Ù‚Ù… Ø§Ù„Ù…Ù„ÙØŒ Ø£Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ØŒ ÙˆÙŠØ¸Ù‡Ø± Ù„Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶ ÙˆØ¢Ø®Ø± Ù…Ø±Ø­Ù„Ø© ÙˆØµÙ„ Ù„Ù‡Ø§.
        </div>

        <form id="searchForm">
          <div class="two-column">
            <div class="field">
              <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù</label>
              <input type="text" id="searchFileInput" />
            </div>
            <div class="field">
              <label>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</label>
              <input type="text" id="searchBarcodeInput" />
            </div>
          </div>
          <div class="section-actions">
            <button type="submit" class="btn btn-primary">Ø¨Ø­Ø«</button>
          </div>
        </form>

        <div class="results-box" id="searchResults">
          Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¨Ø­Ø« Ø¨Ø¹Ø¯.
        </div>
      </section>

      <!-- ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª â€“ Ù„Ø£Ø®ØµØ§Ø¦ÙŠØ© Ø§Ù„Ù…Ø¹Ù…Ù„ ÙÙ‚Ø· -->
      <section class="section-panel" id="statsSection" style="display:none;">
        <h3>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª â€“ Lab Specialist Dashboard</h3>
        <div class="section-subtitle">
          <span class="specialist-tag">
            <span class="pill">Specialist Only</span>
            Ø¯Ø®ÙˆÙ„Ù‡Ø§ ÙŠÙƒÙˆÙ† Ø¨ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø®Ø§ØµØ© <code>0987</code>.
          </span>
          <br />
          Ù‡Ù†Ø§ Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹ Ù†Ø¬Ù…Ø¹ Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ù„ÙƒÙ„ Ù‚Ø³Ù… ÙˆÙ„ÙƒÙ„ ÙÙ†ÙŠØŒ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¬Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ù…ÙƒØªÙ…Ù„Ø©.
        </div>

        <div class="stats-grid" id="statsGrid">
          <div class="stat-card">
            <div class="muted">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù‘Ù„Ø©</div>
            <strong id="totalCasesStat">â€“</strong>
          </div>
          <div class="stat-card">
            <div class="muted">Ø­Ø§Ù„Ø§Øª â€œEntered from Clinicâ€</div>
            <strong id="enteredFromClinicStat">â€“</strong>
          </div>
          <div class="stat-card">
            <div class="muted">Ø­Ø§Ù„Ø§Øª â€œReceived at Labâ€</div>
            <strong id="receivedAtLabStat">â€“</strong>
          </div>
          <div class="stat-card">
            <div class="muted">Ø­Ø§Ù„Ø§Øª Ready for Clinic</div>
            <strong id="readyForClinicStat">â€“</strong>
          </div>
        </div>

        <div class="section-footer-note">
          Ù‡Ø°Ù‡ Ù†Ø³Ø®Ø© Ø£ÙˆÙ„ÙŠØ©ØŒ Ø¨Ø¹Ø¯ÙŠÙ† Ù†Ø¶ÙŠÙ ØªÙ‚Ø³ÙŠÙ… Ø­Ø³Ø¨:
          <strong>Ø§Ù„Ù‚Ø³Ù… / Ø§Ù„ÙÙ†ÙŠ / Ø§Ù„ÙŠÙˆÙ… / Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</strong> Ù…Ø¹ Ø£Ù„ÙˆØ§Ù† ÙˆØ±Ø³ÙˆÙ…Ø§Øª Ø£ÙƒØ«Ø±.
        </div>
      </section>

      <!-- ğŸ—‚ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø© â€“ placeholder -->
      <section class="section-panel" id="rejectedSection" style="display:none;">
        <h3>ğŸ—‚ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©</h3>
        <div class="section-subtitle">
          Ù‡Ù†Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù„ÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠÙ…Ù†Ø¹Ù‡Ø§ (Ù…Ø«Ù„ TM Ø£Ùˆ RPD Ø£Ù‚Ù„ Ù…Ù† Ù£ Ø£Ø³Ù†Ø§Ù†)ØŒ
          Ø¹Ø´Ø§Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© ØªØ¹Ø±Ù Ù‚Ø¨Ù„ Ù…Ø§ ØªØ§Ø®Ø° Ø§Ù„Ø·Ø¨Ø¹Ø©.
        </div>
        <div class="muted">
          Ø­Ø§Ù„ÙŠØ§Ù‹ Ù…Ø¬Ø±Ø¯ Ù…ÙƒØ§Ù† Ø¬Ø§Ù‡Ø²ØŒ Ø¨Ø¹Ø¯ Ù…Ø§ Ù†Ø±Ø¨Ø· Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø±ÙØ¶ Ù†Ø¹Ø±Ø¶Ù‡Ø§ Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.
        </div>
      </section>

    </section>
  </main>
</div>

<!-- Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø±ÙŠ -->
<div class="settings-button">
  <div class="settings-chip" id="settingsBtn">
    <span class="icon">âš™ï¸</span>
    <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª / Settings</span>
  </div>
</div>

<!-- Firebase + Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª -->
<script type="module">
  // âœ… 1) Ø§Ø³ØªÙŠØ±Ø§Ø¯ Firebase Ù…Ù† CDN (ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø¥Ù† Ù„Ø²Ù…)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getFirestore, collection, addDoc, doc, getDoc, getDocs, query, where, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

  // âœ… 2) Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ â€“ Ø§Ø³ØªØ¨Ø¯Ù„ÙŠ Ø¨Ù…Ø§ Ù†Ø³Ø®ØªÙÙ‡ Ù…Ù† Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyARQRegsdUi6hO_p6txm1XjnAV45cAU4Ac",
    authDomain: "dsa-lab-system.firebaseapp.com",
    projectId: "dsa-lab-system",
    storageBucket: "dsa-lab-system.firebasestorage.app",
    messagingSenderId: "1081285804674",
    appId: "1:1081285804674:web:91e4775b7bfa5e60366a9b",
    measurementId: "G-271TRGHNVJ"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ğŸ” Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
  const NORMAL_PASSWORD = "1234";
  const SPECIALIST_PASSWORD = "0987";
  const SETTINGS_PASSWORD = "3333";

  let currentUser = {
    name: null,
    role: null // "team" Ø£Ùˆ "specialist"
  };

  // Ø¹Ù†Ø§ØµØ± DOM Ø£Ø³Ø§Ø³ÙŠØ©
  const loginScreen = document.getElementById("loginScreen");
  const dashboardScreen = document.getElementById("dashboardScreen");
  const loginBtn = document.getElementById("loginBtn");
  const loginName = document.getElementById("loginName");
  const loginPassword = document.getElementById("loginPassword");
  const loginError = document.getElementById("loginError");
  const userNameHeader = document.getElementById("userNameHeader");
  const userRoleHeader = document.getElementById("userRoleHeader");

  function showScreen(id) {
    document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  }

  function setUserHeader() {
    userNameHeader.textContent = currentUser.name ? currentUser.name.toUpperCase() : "ØºÙŠØ± Ù…Ø³Ø¬Ù‘Ù„";
    if (!currentUser.role) {
      userRoleHeader.textContent = "â€”";
    } else if (currentUser.role === "specialist") {
      userRoleHeader.textContent = "Lab Specialist â€“ Ù„ÙˆØ­Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ğŸ’š";
    } else {
      userRoleHeader.textContent = "Team Member â€“ Ù…Ø¹Ø§ Ù†Ø®Ù„ÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø±ØªØ¨ ğŸŒ¿";
    }
  }

  // ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  loginBtn.addEventListener("click", () => {
    const name = loginName.value.trim() || "Guest";
    const pass = loginPassword.value.trim();

    if (!pass) {
      loginError.textContent = "ÙØ¶Ù„Ø§Ù‹ Ø£Ø¯Ø®Ù„ÙŠ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.";
      return;
    }

    if (pass === SPECIALIST_PASSWORD) {
      currentUser = { name, role: "specialist" };
      loginError.textContent = "";
      setUserHeader();
      showScreen("dashboardScreen");
      alert("ÙŠØ§ Ù…Ø±Ø­Ø¨Ø§ Ø¨Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠØ© ğŸŒŸ Ø¬Ø§Ù‡Ø²ÙŠÙ† Ù†Ø´ÙˆÙ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªØŸ");
    } else if (pass === NORMAL_PASSWORD) {
      currentUser = { name, role: "team" };
      loginError.textContent = "";
      setUserHeader();
      showScreen("dashboardScreen");
      alert("Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­ ğŸ’š ÙŠÙˆÙ… Ù…Ù„ÙŠØ§Ù† Ø¥Ù†Ø¬Ø§Ø² Ø¨Ø¥Ø°Ù† Ø§Ù„Ù„Ù‡.");
    } else {
      loginError.textContent = "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.";
    }
  });

  // ğŸ”„ ÙØªØ­ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
  const sectionIds = [
    "newCaseSection",
    "labReceiveSection",
    "searchSection",
    "assistantReceiveSection",
    "statsSection",
    "rejectedSection"
  ];

  function showSection(id) {
    sectionIds.forEach(secId => {
      document.getElementById(secId).style.display = (secId === id) ? "block" : "none";
    });

    // Ù„Ùˆ ÙØªØ­Ù†Ø§ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª â€“ Ù†Ø­Ø¯Ù‘Ø« Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
    if (id === "statsSection") {
      loadStats();
    }
  }

  document.querySelectorAll(".card[data-section]").forEach(card => {
    card.addEventListener("click", () => {
      const id = card.getAttribute("data-section");
      if (id === "statsSection" && currentUser.role !== "specialist") {
        alert("Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„Ù„Ø£Ø®ØµØ§Ø¦ÙŠØ© ÙÙ‚Ø· (Ø¯Ø®ÙˆÙ„ Ø¨ÙƒÙ„Ù…Ø© 0987).");
        return;
      }
      showSection(id);
    });
  });

  // ğŸ“ Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ cases + tracking
  const newCaseForm = document.getElementById("newCaseForm");
  const newCaseError = document.getElementById("newCaseError");
  const clearNewCaseBtn = document.getElementById("clearNewCaseBtn");

  clearNewCaseBtn.addEventListener("click", () => {
    newCaseForm.reset();
    newCaseError.textContent = "";
  });

  newCaseForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    newCaseError.textContent = "";

    const fileNumber = document.getElementById("fileNumberInput").value.trim();
    const patientName = document.getElementById("patientNameInput").value.trim();
    const clinicNumber = document.getElementById("clinicNumberInput").value.trim();
    const doctorName = document.getElementById("doctorNameInput").value.trim();
    const caseType = document.getElementById("caseTypeInput").value;
    const nextAppointment = document.getElementById("nextAppointmentInput").value;
    const note = document.getElementById("noteInput").value.trim();
    const imageUrl = document.getElementById("imageUrlInput").value.trim();

    if (!fileNumber || !patientName || !clinicNumber) {
      newCaseError.textContent = "Ø±Ù‚Ù… Ø§Ù„Ù…Ù„ÙØŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶ØŒ ÙˆØ±Ù‚Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø­Ù‚ÙˆÙ„ Ø£Ø³Ø§Ø³ÙŠØ©.";
      return;
    }

    const labNumber = "LAB-" + Date.now().toString().slice(-6);
    const barcode = labNumber; // Ù…Ø¨Ø¯Ø¦ÙŠØ§Ù‹ Ù†Ø®Ù„ÙŠ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù†ÙØ³ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„

    try {
      // Ø¥Ø¶Ø§ÙØ© ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© cases
      const caseRef = await addDoc(collection(db, "cases"), {
        fileNumber,
        patientName,
        clinicNumber,
        doctorName,
        caseType,
        nextAppointment: nextAppointment || null,
        note: note || "",
        createdAt: serverTimestamp(),
        labNumber,
        barcode,
        createdBy: currentUser.name || "Clinic Reception"
      });

      // Ø£ÙˆÙ„ Ø­Ø±ÙƒØ© ÙÙŠ tracking
      await addDoc(collection(caseRef, "tracking"), {
        status: "Entered from Clinic",
        updatedBy: currentUser.name || "Clinic Reception",
        time: serverTimestamp(),
        note: "Case added to system"
      });

      alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰\nLab Number / Barcode: " + labNumber);
      newCaseForm.reset();
    } catch (err) {
      console.error(err);
      newCaseError.textContent = "Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸. ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.";
    }
  });

  // ğŸ­ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ â€“ Ù†Ø­Ø¯Ù‘Ø« tracking ÙÙ‚Ø· (Ø§Ù„Ø¨Ø­Ø« Ø¨Ø³ÙŠØ· Ø¹Ù„Ù‰ fileNumber)
  const labReceiveForm = document.getElementById("labReceiveForm");
  const labReceiveError = document.getElementById("labReceiveError");

  labReceiveForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    labReceiveError.textContent = "";

    const barcode = document.getElementById("barcodeReceiveInput").value.trim();
    const fileNo = document.getElementById("fileReceiveInput").value.trim();

    if (!barcode && !fileNo) {
      labReceiveError.textContent = "ÙØ¶Ù„Ø§Ù‹ Ø£Ø¯Ø®Ù„ÙŠ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù.";
      return;
    }

    try {
      let q;
      if (barcode) {
        q = query(collection(db, "cases"), where("barcode", "==", barcode));
      } else {
        q = query(collection(db, "cases"), where("fileNumber", "==", fileNo));
      }

      const snap = await getDocs(q);
      if (snap.empty) {
        labReceiveError.textContent = "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ù…Ø·Ø§Ø¨Ù‚Ø©.";
        return;
      }

      const caseDoc = snap.docs[0];
      await addDoc(collection(caseDoc.ref, "tracking"), {
        status: "Received at Lab",
        updatedBy: currentUser.name || "Lab Receiver",
        time: serverTimestamp(),
        note: "Case checked-in at lab"
      });

      alert("ØªÙ… ØªØ£ÙƒÙŠØ¯ ÙˆØµÙˆÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù„Ù…Ø¹Ù…Ù„ âœ…");
      labReceiveForm.reset();
    } catch (err) {
      console.error(err);
      labReceiveError.textContent = "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«. Ø¬Ø±Ù‘Ø¨ÙŠ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
    }
  });

  // ğŸ“¦ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù…Ù† Ø§Ù„ÙÙ†ÙŠ / Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©
  const assistantReceiveForm = document.getElementById("assistantReceiveForm");
  const assistantReceiveError = document.getElementById("assistantReceiveError");

  assistantReceiveForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    assistantReceiveError.textContent = "";

    const barcode = document.getElementById("assistantBarcodeInput").value.trim();
    const assistantName = document.getElementById("assistantNameInput").value.trim() || currentUser.name || "Assistant";

    if (!barcode) {
      assistantReceiveError.textContent = "ÙØ¶Ù„Ø§Ù‹ Ø£Ø¯Ø®Ù„ÙŠ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯.";
      return;
    }

    try {
      const q = query(collection(db, "cases"), where("barcode", "==", barcode));
      const snap = await getDocs(q);

      if (snap.empty) {
        assistantReceiveError.textContent = "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯.";
        return;
      }

      const caseDoc = snap.docs[0];
      await addDoc(collection(caseDoc.ref, "tracking"), {
        status: "Ready for Clinic",
        updatedBy: assistantName,
        time: serverTimestamp(),
        note: "Case delivered from lab to clinic"
      });

      alert("ÙŠØ¹Ø·ÙŠÙƒ Ø§Ù„Ø¹Ø§ÙÙŠØ© ğŸ¤ğŸ’š Ø®Ø·ÙˆØ© Ø¬Ø¯ÙŠØ¯Ø© ØªÙ‚Ø±Ù‘Ø¨Ù†Ø§ Ù…Ù† Ø§Ø¨ØªØ³Ø§Ù…Ø© Ø§Ù„Ù…Ø±ÙŠØ¶ Ø§Ù„Ø¬Ù…ÙŠÙ„Ø©.");
      assistantReceiveForm.reset();
    } catch (err) {
      console.error(err);
      assistantReceiveError.textContent = "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«.";
    }
  });

  // ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø­Ø§Ù„Ø© â€“ Ø¹Ø±Ø¶ Ø¨Ø³ÙŠØ· Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆØ§Ù„Ø­Ø±ÙƒØ§Øª
  const searchForm = document.getElementById("searchForm");
  const searchResults = document.getElementById("searchResults");

  searchForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    searchResults.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ...";

    const fileNo = document.getElementById("searchFileInput").value.trim();
    const barcode = document.getElementById("searchBarcodeInput").value.trim();

    if (!fileNo && !barcode) {
      searchResults.textContent = "ÙØ¶Ù„Ø§Ù‹ Ø£Ø¯Ø®Ù„ÙŠ Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯.";
      return;
    }

    try {
      let q;
      if (barcode) {
        q = query(collection(db, "cases"), where("barcode", "==", barcode));
      } else {
        q = query(collection(db, "cases"), where("fileNumber", "==", fileNo));
      }

      const snap = await getDocs(q);
      if (snap.empty) {
        searchResults.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø© Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©.";
        return;
      }

      const caseDoc = snap.docs[0];
      const data = caseDoc.data();

      // Ù†Ø¬ÙŠØ¨ Ø­Ø±ÙƒØ§Øª Ø§Ù„ØªØªØ¨Ø¹
      const trackSnap = await getDocs(collection(caseDoc.ref, "tracking"));
      const tracks = [];
      trackSnap.forEach(d => {
        tracks.push({ id: d.id, ...d.data() });
      });
      tracks.sort((a,b) => (a.time?.seconds || 0) - (b.time?.seconds || 0));

      let html = "";
      html += `<div><strong>Ø§Ù„Ù…Ø±ÙŠØ¶:</strong> ${data.patientName || "-"} <br />`;
      html += `<strong>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù:</strong> ${data.fileNumber || "-"}<br />`;
      html += `<strong>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ / Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯:</strong> ${data.labNumber || data.barcode || "-"}<br />`;
      html += `<strong>Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©:</strong> ${data.clinicNumber || "-"} â€“ <strong>Ø§Ù„Ø·Ø¨ÙŠØ¨:</strong> ${data.doctorName || "-"}<br />`;
      html += `<strong>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${data.caseType || "-"}<br />`;
      if (data.nextAppointment) {
        html += `<strong>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø±ÙŠØ¶ Ø§Ù„Ù‚Ø§Ø¯Ù…:</strong> ${data.nextAppointment}<br />`;
      }
      if (data.note) {
        html += `<strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ${data.note}<br />`;
      }
      html += `</div><hr />`;

      html += `<div><strong>Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ø§Ù„Ø© (Tracking):</strong><br />`;
      if (!tracks.length) {
        html += `<span class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</span>`;
      } else {
        html += `<ul style="padding-right:18px; margin-top:6px;">`;
        for (const t of tracks) {
          const dateStr = t.time?.toDate ? t.time.toDate().toLocaleString() : "-";
          html += `<li><span class="badge gray">${t.status}</span> Ø¨ÙˆØ§Ø³Ø·Ø© ${t.updatedBy || "-"} â€“ <span class="muted">${dateStr}</span>`;
          if (t.note) html += `<br /><span class="muted">${t.note}</span>`;
          html += `</li>`;
        }
        html += `</ul>`;
      }
      html += `</div>`;

      searchResults.innerHTML = html;
    } catch (err) {
      console.error(err);
      searchResults.textContent = "Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«.";
    }
  });

  // ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø³ÙŠØ·Ø© Ù…Ø¨Ø¯Ø¦ÙŠØ©
  async function loadStats() {
    if (currentUser.role !== "specialist") return;

    try {
      const snap = await getDocs(collection(db, "cases"));
      const allCases = [];
      snap.forEach(d => allCases.push({ id: d.id, ...d.data() }));

      document.getElementById("totalCasesStat").textContent = allCases.length.toString();

      // Ù†Ø­ØªØ§Ø¬ ØªÙ…Ø± Ø¹Ù„Ù‰ ÙƒÙ„ tracking
      let entered = 0, received = 0, ready = 0;
      for (const c of snap.docs) {
        const trSnap = await getDocs(collection(c.ref, "tracking"));
        trSnap.forEach(t => {
          const status = t.data().status;
          if (status === "Entered from Clinic") entered++;
          if (status === "Received at Lab") received++;
          if (status === "Ready for Clinic") ready++;
        });
      }

      document.getElementById("enteredFromClinicStat").textContent = entered.toString();
      document.getElementById("receivedAtLabStat").textContent = received.toString();
      document.getElementById("readyForClinicStat").textContent = ready.toString();
    } catch (err) {
      console.error(err);
      alert("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.");
    }
  }

  // âš™ï¸ Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª â€“ Ø¨Ø±Ù‚Ù… Ø³Ø±ÙŠ Ø¨Ø³ÙŠØ· (Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù†Ø¶ÙŠÙ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙ†ÙŠØ©)
  document.getElementById("settingsBtn").addEventListener("click", () => {
    const pwd = prompt("Ø£Ø¯Ø®Ù„ÙŠ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:");
    if (pwd === SETTINGS_PASSWORD) {
      alert("Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ± ğŸ”§âœ¨ (Ø­Ø§Ù„ÙŠØ§Ù‹ ÙÙ‚Ø· Ø­Ù…Ø§ÙŠØ© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ø²Ø±).");
    } else if (pwd !== null) {
      alert("ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©.");
    }
  });

  // Ù„Ø±Ø§Ø­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… â€“ Enter ÙŠØ¹Ù…Ù„ Ø¯Ø®ÙˆÙ„
  loginPassword.addEventListener("keydown", (e) => {
    if (e.key === "Enter") loginBtn.click();
  });
</script>

</body>
</html>
